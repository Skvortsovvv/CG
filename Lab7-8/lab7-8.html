<html>
    <body>
        <canvas id='lab78' width='1000' height='700' style='border:1px solid' tabindex='1'></canvas>
        <script src='bresenham.js' type='text/javascript'></script>
        </script><script>
            function Mult_Mv(M,v){
                var res = [];
                for (var i = 0; i < 4; ++i){
                    res.push(0);
                    for (var j = 0; j < 4; ++j){
                        res[i] = res[i] + M[i*4+j] * v[j];
                    }
                }
                return res;
            }
        </script>
        <script>
            var canvas = document.getElementById("lab78")
            var ctx = canvas.getContext("2d")
            ctx.fillStyle = '#000000'
            canvas.setAttribute("tabindex", 0);
            var alpha = 40*Math.PI/180;
            
            
            var M_y = [ Math.sin(alpha), 0, Math.cos(alpha), 0,
                    0, 1, 0, 0,
                    Math.cos(alpha), 0, -1*Math.sin(alpha), 0,
                    0, 0, 0, 1];

            var M_z = [ Math.cos(alpha), -1*Math.sin(alpha), 0, 0,
                    Math.sin(alpha), Math.cos(alpha), 0, 0,
                    0, 0, 0, 0,
                    0, 0, 0, 1];

            var points = [[30, 30, 0], [130, 30, 0], [130, 130, 0], [30, 130, 0], [80, 80, 160]]
                    //      1              2            3              4           5                
            for (var i = 0; i < points.length-2; ++i){
                Line(ctx, points[i][0], points[i][1], points[i+1][0], points[i+1][1])
            }
            Line(ctx, points[points.length-2][0],points[points.length-2][1],
                    points[0][0], points[0][1])
            ctx.fillStyle = "red"
            ctx.fillRect(points[points.length-1][0], points[points.length-1][1], 5, 5)
            for (var i = 0; i < points.length; ++i){
                points[i][0] -= points[points.length-1][0]
                points[i][1] -= points[points.length-1][1]
                var out = Mult_Mv(M_z, [points[i][0], points[i][1], points[i][2], 1])
                points[i][0] = out[0] + points[points.length-1][0]
                points[i][1] = out[1] + points[points.length-1][1]
            }

            var alpha = 70*Math.PI/180;
            var M_x = [ 1, 0, 0, 0,
                    0, Math.cos(alpha), -1*Math.sin(alpha), 0,
                    0, Math.sin(alpha), Math.cos(alpha), 0,
                    0, 0, 0, 1];

             
            for (var i = 0; i < points.length; ++i){
                points[i][0] -= points[points.length-1][0]
                points[i][1] -= points[points.length-1][1]
                var out = Mult_Mv(M_x, [points[i][0], points[i][1], points[i][2], 1])
                points[i][0] = out[0] + points[points.length-1][0]
                points[i][1] = out[1] + points[points.length-1][1] + points[points.length-1][2]
            }   
            for (var i = 0; i < points.length-2; ++i){
                Line(ctx, points[i][0], points[i][1], points[i+1][0], points[i+1][1])
            }
            Line(ctx, points[points.length-2][0],points[points.length-2][1],
                    points[0][0], points[0][1])
            alert(points[4][1])      
            // points[1][0] -= pointCenter[0]
            // points[1][1] -= pointCenter[1]
            // var out = Mult_Mv(M_z, [points[1][0], points[1][1], points[1][2], 1]) // Поворот вокруг OZ
            // points[1][0] = out[0] + pointCenter[0]
            // points[1][1] = out[1] + pointCenter[1]
            // ctx.fillStyle = '#000000'
            // ctx.fillRect(points[1][0], points[1][1], 5, 5)    

        </script>
    </body>
</html>